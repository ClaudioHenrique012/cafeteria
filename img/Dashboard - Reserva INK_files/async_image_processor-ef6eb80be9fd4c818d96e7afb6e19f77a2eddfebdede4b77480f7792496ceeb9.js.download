async function getImage(e){const a=new Headers;a.append("cache-control","no-cache");const t={method:"GET",headers:a,mode:"cors"},n=await fetch(e,t),o=await n.arrayBuffer();return new Uint8Array(o)}async function scaleArtImage(e,a){try{const t=[{name:"art_image.png",content:await e.arrayBuffer()}],n=["convert","art_image.png","-resize",100*a+"%","scaled_art_image.png"],o=(await window.magick.Call(t,n))[0];return new Uint8Array(o.buffer)}catch(e){throw console.error(e),e}}function getScale(e,a){return finalWidth=a.x_placement_end-a.x_placement_begin,finalWidth/e.width}function commandBySetupParams(e){return"multiply"==e.filter?["composite","-compose","Multiply","-geometry",imagePosition(e),"art_image.png","base_image.png","out.png"]:["composite","-geometry",imagePosition(e),"art_image.png","base_image.png","out.png"]}function imagePosition(e){return`+${e.x_placement_begin}+${e.y_placement_begin}`}function removeUploadInfo(e){addClasses([document.querySelector(`#section-image-preview-${e}`),document.querySelector(`#upload-info-${e}`)],"hidden")}function removeProgress(e){addClasses([document.querySelector(`#progress-image-${e}`)],"hidden")}function uploadImagePreview(e,a){convertBlobToBase64(a,(function(a){setImagePreview(`#image-preview-${e}`,a)}))}function convertBlobToBase64(e,a){let t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){a("data:image/png;"+t.result)}}function setImagePreview(e,a){document.querySelectorAll(e).forEach((function(t){const n=e.split("-")[e.split("-").length-1];addClasses([document.getElementById(`uploading-preview-${n}`)],"hidden");const o=document.getElementById(`remove-template-${n}`);o&&removeClasses([o],"hidden"),t.src=a,removeClasses(document.querySelectorAll(`#section-image-preview-${n}`),"hidden"),removeClasses(document.querySelectorAll(`#edit-image-${n}`),"hidden"),addClasses(document.querySelectorAll(`#progress-image-${n}`),"hidden"),addClasses(document.querySelectorAll(`#upload-info-${n}`),"hidden"),addClasses(document.querySelectorAll(`#uploading-preview-${n}`),"hidden")}))}import{addClasses}from"../../../../javascript/utils/add_classes";import{removeClasses}from"../../../../javascript/utils/remove_classes";export async function updateImagePreview(e,a,t,n,o){try{const a=getScale(t,n),r=getImage(e),i=scaleArtImage(o,a),[s,c]=await Promise.all([r,i]),l=commandBySetupParams(n),m=(await window.magick.Call([{name:"base_image.png",content:s},{name:"art_image.png",content:c}],l))[0];uploadImagePreview(n.id,m.blob)}catch(e){console.error(e),removeProgress(n.id)}}